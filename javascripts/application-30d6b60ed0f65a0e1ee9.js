webpackJsonp([0,1],[function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=(i(2),i(3)),o=i(4),s=i(5),l=i(7),r=i(8),u=function c(){n(this,c),angular.module("appVolpelator",["ngDroplet"]).controller("TonyViewerController",["TonyDataService",a]).controller("TonyFooterController",["TonyDataService",o]).controller("TonyMakerController",["TonyDataService","$scope","$window","$interval",s]).service("TonyDataService",["$http","$q","$log",l]).directive("onLongPress",["$interval",r])};t["default"]=u;new u;e.exports=t["default"]},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){i(this,e),this.rootElement=t,this.init()}return n(e,[{key:"init",value:function(){this.canvas=this.rootElement.getElementsByTagName("canvas")[0],this.initLoad()}},{key:"initLoad",value:function(){this.preload=new createjs.LoadQueue;var e=this.preload;e.on("complete",this.onFilesLoaded,this),e.loadManifest([{id:"trust",src:"images/loltony-trust-2x.png"},{id:"write",src:"images/loltony-write-2x.png"},{id:"overlay",src:"images/loltony-overlay-2x.png"},{id:"placeholder",src:"images/loltony-placeholder-2x.png"},{id:"base",src:"images/loltony-base-2x.png"}])}},{key:"onFilesLoaded",value:function(){var e=this.preload;this.images={},this.images.trust=e.getResult("trust"),this.images.write=e.getResult("write"),this.images.overlay=e.getResult("overlay"),this.images.placeholder=e.getResult("placeholder"),this.images.base=e.getResult("base"),this.initInternalCanvas()}},{key:"initInternalCanvas",value:function(){this.internalCanvas=document.createElement("canvas");var e=this.internalCanvas;this.internalContext=e.getContext("2d"),e.width=this.images.overlay.width,e.height=this.images.overlay.height;var t=new createjs.Stage(e),i=new createjs.Bitmap(this.images.base),n=new createjs.Bitmap(this.images.placeholder),a=new createjs.Bitmap(this.images.overlay),o=new createjs.Bitmap(this.images.write);new createjs.Bitmap(this.images.trust);t.addChild(i),t.addChild(n),t.addChild(a),t.addChild(o),this.addText(t),t.update();var s=document.getElementById("loltony-holder");s.src=e.toDataURL("image/png")}},{key:"addText",value:function(e){var t=new createjs.Text("Hello World HI HI Hi Hi Hi Hello World HI HI Hi Hi Hi","40px GloriaHallelujah","#000000");t.textAlign="center",t.maxWidth=.5*this.internalCanvas.width,t.text="Hello World",t.x=.7*this.internalCanvas.width,t.y=.5*(.3*this.internalCanvas.height-t.getBounds().height),e.addChild(t)}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){i(this,e),this.tonyDataService=t,this.setDefaultStrings(),this.setDefaultImage(),this.setInteraction()}return n(e,[{key:"setDefaultStrings",value:function(){var e={};e.makeTony="MAKE A TONY",e.copyTony="LINK THIS TONY",this.strings=e}},{key:"setDefaultImage",value:function(){this.currentImage=this.tonyDataService.getCurrentTony()}},{key:"setInteraction",value:function(){$("[data-toggle='popover']").popover()}},{key:"onMakeTony",value:function(){console.log("make")}},{key:"onCopyTony",value:function(){console.log("copy",$(".popover-content").html());var e=$(".popover-content")[0];if(document.selection){console.log("if",e);var t=document.body.createTextRange();t.moveToElementText(e),t.select()}else if(window.getSelection){console.log("else",e);var t=document.createRange();t.selectNodeContents(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),console.log(window.getSelection())}}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){i(this,e),this.tonyDataService=t,this.initStrings(),this.init()}return n(e,[{key:"initStrings",value:function(){var e={};e.title="LOOK AT SOME TONIES",this.strings=e}},{key:"init",value:function(){var e={};e.thumbList=this.tonyDataService.getThumbList(),this.data=e}},{key:"onThumbClick",value:function(e){console.log("click",e),this.tonyDataService.setCurrentTony(e),$("body").animate({scrollTop:0},"swing")}},{key:"onReady",value:function(){}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(6),s=function(){function e(t,i,a,s){n(this,e),this.$scope=i,this.$window=a,this.$interval=s,this.tonyDataService=t,this.dragDropInterface={},this.textId="tonytext",this.imageView=new o(s),this.reset(),this.init()}return a(e,[{key:"init",value:function(){this.initDragAndDrop(),this.initFileSelect(),this.imageView.init(),this.onTextBlur()}},{key:"reset",value:function(){this.photoScale=100,this.hasImage=!1,this.hasText=!1,this.enableSave(),document.getElementById(this.textId).value="",this.imageView.reset()}},{key:"initDragAndDrop",value:function(){var e=this,t=this.$scope;t.$on("$dropletReady",function(){e.dragDropInterface.allowedExtensions(["png","jpg","bmp","gif","svg"])}),t.$on("$dropletFileAdded",function(t,i){e.addMainImageFromFile(i.file)})}},{key:"initFileSelect",value:function(){var e=this,t=document.getElementById("loltony-file-select");t.setAttribute("type","file"),t.setAttribute("accepts","image/*"),t.setAttribute("multiple",!1),t.addEventListener("change",function(){e.addMainImageFromFile(t.files[0])}),this.fileSelectElem=t}},{key:"onSelectFile",value:function(){this.fileSelectElem.value=null,this.fileSelectElem.click()}},{key:"addMainImageFromFile",value:function(e){var t=this,i=new Image;i.addEventListener("load",function(){t.photoScale=t.imageView.setMainImage(i),t.hasImage=!0,t.enableSave(),t.$scope.$apply()}),i.src=this.$window.URL.createObjectURL(e)}},{key:"enableSave",value:function(){this.hasText&&this.hasImage?this.canSave="enabled":this.canSave="disabled"}},{key:"setTextFocus",value:function(){var e=document.getElementById(this.textId);e.style.visibility="visible",e.focus()}},{key:"onTextFocus",value:function(){this.imageView.onTextFocus()}},{key:"onTextChange",value:function(){this.hasText=!0,this.enableSave(),this.imageView.onTextChange(this.tonyText)}},{key:"onTextBlur",value:function(){document.getElementById(this.textId).style.visibility="hidden"}},{key:"onScaleChange",value:function(e){this.photoScale+=e,this.imageView.onScaleChange(this.photoScale)}},{key:"onSaveImage",value:function(){var e=this;if("enabled"===this.canSave){this.canSave="disabled";var t=this.imageView.getCanvasData();this.tonyDataService.uploadTony(t,function(t,i){console.log(t,i),"error"===t&&(e.enableSave(),$("#tonymaker-overlay").modal("hide"),$("#tonymaker-error").modal("show").on("hide.bs.modal",function(){$("#tonymaker-overlay").modal("show")}))})}}}]),e}();t["default"]=s,e.exports=t["default"]},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){i(this,e),this.$interval=t}return n(e,[{key:"init",value:function(){this.images={},this.fullPhotoBounds={x:240,y:180,width:414,height:474,xRatio:0,yRatio:0},this.internalCanvas=document.createElement("canvas"),this.imageHolder=document.getElementById("loltony-holder"),this.children={},this.centerTextY=0,this.twoLineTextY=0,this.multiLineTextY=0,this.initLoad()}},{key:"initLoad",value:function(){var e=this,t=new createjs.LoadQueue;t.on("complete",function(){e.onFilesLoaded(t)},this),t.loadManifest([{id:"trust",src:"images/loltony-trust-2x.png"},{id:"write",src:"images/loltony-write-2x.png"},{id:"overlay",src:"images/loltony-overlay-2x.png"},{id:"placeholder",src:"images/loltony-placeholder-2x.png"},{id:"base",src:"images/loltony-base-2x.png"}])}},{key:"onFilesLoaded",value:function(e){this.images.trust=e.getResult("trust"),this.images.write=e.getResult("write"),this.images.overlay=e.getResult("overlay"),this.images.placeholder=e.getResult("placeholder"),this.images.base=e.getResult("base"),this.initInternalCanvas()}},{key:"initInternalCanvas",value:function(){var e=this.internalCanvas;e.width=this.images.overlay.width,e.height=this.images.overlay.height;var t=this.fullPhotoBounds;t.xRatio=t.x/e.width,t.yRatio=t.y/e.height,this.stage=new createjs.Stage(e),this.addChildren()}},{key:"addChildren",value:function(){var e=this.stage,t=this.children,i=new createjs.Bitmap(this.images.placeholder);e.addChild(i),t.placeholderImg=i;var n=new createjs.Bitmap(this.images.base);e.addChild(n),n.compositeOperation="multiply",t.baseImg=n;var a=new createjs.Bitmap(this.images.overlay);e.addChild(a),t.overlayImg=a;var o=new createjs.Bitmap(this.images.write);e.addChild(o),t.writeImg=o;var s=new createjs.Bitmap(this.images.trust);e.addChild(s),s.visible=!1,t.trustImg=s,this.addText(),this.update(),this.initComplete=!0}},{key:"update",value:function(){var e=this.internalCanvas;this.stage.update(),this.imageHolder.src=e.toDataURL("image/jpeg")}},{key:"reset",value:function(){if(this.initComplete){var e=this.children;e.writeImg.visible=!0,e.placeholderImg.visible=!0,e.text.visible=!1,e.text.text="",e.mainImg&&this.stage.contains(e.mainImg)&&(this.stage.removeChild(e.mainImg),e.mainImg.image=null,e.mainImg=null,this.images.main=null),this.update()}}},{key:"addText",value:function(e){var t=new createjs.Text("...","38px GloriaHallelujah","#000000");t.textAlign="center",t.lineWidth=.63*this.internalCanvas.width,t.x=.68*this.internalCanvas.width,t.y=.5*(.3*this.internalCanvas.height-t.getBounds().height),t.rotation=-2,t.visible=!1,this.centerTextY=t.y,this.twoLineTextY=.5*(.3*this.internalCanvas.height-2*t.getBounds().height),this.multiLineTextY=.5*(.3*this.internalCanvas.height-3*t.getBounds().height),t.text="",this.stage.addChild(t),this.children.text=t}},{key:"onTextFocus",value:function(){this.children.text.visible=!0}},{key:"onTextChange",value:function(e){var t=this.children;t.text.text=e,t.text.visible=!0;var i=t.text.getMetrics().lines.length;i>2?t.text.y=this.multiLineTextY:2==i?t.text.y=this.twoLineTextY:t.text.y=this.centerTextY,t.writeImg.visible=!1,this.update()}},{key:"onScaleChange",value:function(e){var t=this.children.mainImg;t&&(t.scaleX=t.scaleY=.01*e,this.update())}},{key:"setMainImage",value:function(e){var t=this.stage,i=this.children.placeholderImg,n=this.fullPhotoBounds,a=new createjs.Bitmap(e);this.images.main=e,this.children.mainImg=a,a.x=n.x,a.y=n.y;var o=a.image.naturalWidth/n.width,s=a.image.naturalHeight/n.height,l=s>o?1/o:1/s;return a.scaleX=a.scaleY=l,t.addChildAt(a,0),i.visible=!1,this.update(),this.setDragHandler(),Math.ceil(100*l)}},{key:"modifyMainImagePosition",value:function(e,t){this.children.mainImg.x+=e,this.children.mainImg.y+=t}},{key:"setDragHandler",value:function(){var e=this,t=function(t){if(t.stopPropagation(),"touchstart"===t.type){var i={};i.pageX=t.changedTouches[0].pageX,i.pageY=t.changedTouches[0].pageY,e.touchEventCoords={x:i.pageX,y:i.pageY},e.onEventBegin(i,"touchmove","touchend")}else e.onEventBegin(t,"mousemove","mouseup")};this.imageHolder.addEventListener("touchstart",t,!1),this.imageHolder.addEventListener("mousedown",t,!1)}},{key:"onEventBegin",value:function(e,t,i){var n=this;this.isPointWithinBounds(e)&&!function(){var e="touchmove"===t?6:30;n.updateInterval=n.$interval(function(e){n.update()},1/e);var a=document.getElementsByTagName("body")[0],o=function(e){n.modifyMainImagePosition(e.movementX,e.movementY)},s=function(e){e.stopPropagation(),e.preventDefault();var t=n.touchEventCoords,i=e.changedTouches[0].pageX,a=e.changedTouches[0].pageY,s={};s.movementX=i-t.x,s.movementY=a-t.y,t.x=i,t.y=a,o(s)},l="touchmove"===t?s:o,r=function u(e){e.stopPropagation(),e.preventDefault(),n.$interval.cancel(n.updateInterval),a.removeEventListener(t,l,!1),a.removeEventListener(i,u,!1),n.touchEventCoords=null};a.addEventListener(t,l,!1),a.addEventListener(i,r,!1)}()}},{key:"isPointWithinBounds",value:function(e){var t=this.imageHolder,i=this.fullPhotoBounds,n=this.globalToLocal($(t),e.pageX,e.pageY),a=n.x/t.width,o=n.y/t.height;return a>=i.xRatio&&o>=i.yRatio}},{key:"globalToLocal",value:function(e,t,i){var n=e.offset();return{x:Math.floor(t-n.left),y:Math.floor(i-n.top)}}},{key:"getCanvasData",value:function(){this.children.trustImg.visible=!0,this.stage.update();var e=this.internalCanvas.toDataURL("image/jpeg");return this.children.trustImg.visible=!1,this.stage.update(),e}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t,n,a){i(this,e),this.$http=t,this.$q=n,this.$log=a,this.init(),this.loadData()}return n(e,[{key:"init",value:function(){var e={};e.currentTony={link:"images/meme-2x.jpg",id:"tony-1138",deeplink:location.href+"0"};for(var t=[],i=0;42>i;++i)t.push({url:"/images/meme-2x.jpg",id:"tony-1138-"+i,deeplink:""+location.href+i});e.dummyList=t;var n=[];e.thumbList=n;var a={};a.imageList="api/list",a.imageUpload="api/upload",e.urls=a,this.data=e}},{key:"loadData",value:function(){var e=this;this.$http.get(this.data.urls.imageList).then(function(t){e.setThumbList(t.data)},function(t,i){e.setThumbList(e.data.dummyList),e.$log.warn("$http error - getThumbList: Using dummy list -",t,i)})}},{key:"getThumbList",value:function(){return this.data.thumbList}},{key:"setThumbList",value:function(e){var t=this.data.thumbList;t.splice(0,t.length);for(var i=e.length,n=0;i>n;++n){var a=e[n];t.push(a)}}},{key:"getCurrentTony",value:function(){return this.data.currentTony}},{key:"setCurrentTony",value:function(e){var t=this.data.currentTony,i=this.data.thumbList[e];t.link=i.link,t.id=i.id,t.deeplink=i.deeplink}},{key:"uploadTony",value:function(e,t){this.$http.post(this.data.urls.imageUpload,e).then(function(e){t("success",e)},function(e,i){t("error",{message:e,code:i})})}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){return{restrict:"A",link:function(t,i,n){var a=function(i){i.preventDefault(),t.longPressInterval=e(function(){console.log("longpress"),t.$eval(n.onLongPress)},300)},o=function(i){i.preventDefault(),e.cancel(t.longPressInterval),n.onTouchEnd&&t.$eval(n.onTouchEnd)};i.bind("mousedown",a),i.bind("touchstart",a),i.bind("mouseup",o),i.bind("mouseleave",o),i.bind("touchend",o),i.bind("touchleave",o)}}},e.exports=t["default"]}]);