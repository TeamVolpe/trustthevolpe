webpackJsonp([0,1],[function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(2),s=n(3),r=n(4),l=n(6),u=n(7),c=function(){function e(){i(this,e),angular.module("appVolpelator",["ngDroplet"]).controller("TonyViewerController",["TonyDataService",o]).controller("TonyFooterController",["TonyDataService",s]).controller("TonyMakerController",["TonyDataService","$scope","$window","$interval",r]).service("TonyDataService",["$http","$q","$log","$document",l]).directive("onLongPress",["$interval",u]),$(this.onDocReady)}return a(e,[{key:"onDocReady",value:function(){$("#credits").click(function(){$("#techlead").modal("show")})}}]),e}();t["default"]=c;new c;e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t){n(this,e),this.tonyDataService=t,this.setDefaultStrings(),this.setDefaultImage(),this.setInteraction()}return i(e,[{key:"setDefaultStrings",value:function(){var e={};e.makeTony="MAKE A TONY",e.copyTony="LINK THIS TONY",this.strings=e}},{key:"setDefaultImage",value:function(){this.currentImage=this.tonyDataService.getCurrentTony()}},{key:"setInteraction",value:function(){$("[data-toggle='popover']").popover()}},{key:"onMakeTony",value:function(){console.log("make")}},{key:"onCopyTony",value:function(){console.log("copy",$(".popover-content").html());var e=$(".popover-content")[0];if(document.selection){console.log("if",e);var t=document.body.createTextRange();t.moveToElementText(e),t.select()}else if(window.getSelection){console.log("else",e);var t=document.createRange();t.selectNodeContents(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),console.log(window.getSelection())}}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t){n(this,e),this.tonyDataService=t,this.initStrings(),this.init()}return i(e,[{key:"initStrings",value:function(){var e={};e.title="LOOK AT SOME TONIES",this.strings=e}},{key:"init",value:function(){var e={};e.thumbList=this.tonyDataService.getThumbList(),this.data=e}},{key:"onThumbClick",value:function(e){this.tonyDataService.setCurrentTony(e),$("body").animate({scrollTop:0},"swing")}},{key:"onReady",value:function(){}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(5),s=function(){function e(t,n,a,s){i(this,e),this.$scope=n,this.$window=a,this.$interval=s,this.tonyDataService=t,this.dragDropInterface={},this.textId="tonytext",this.imageView=new o(s),this.reset(),this.init()}return a(e,[{key:"init",value:function(){this.initDragAndDrop(),this.initFileSelect(),this.imageView.init(),this.onTextBlur()}},{key:"reset",value:function(){this.photoScale=100,this.hasImage=!1,this.hasText=!1,this.enableSave(),document.getElementById(this.textId).value="",this.imageView.reset()}},{key:"initDragAndDrop",value:function(){var e=this,t=this.$scope;t.$on("$dropletReady",function(){e.dragDropInterface.allowedExtensions(["png","jpg","bmp","gif","svg"])}),t.$on("$dropletFileAdded",function(t,n){e.addMainImageFromFile(n.file)})}},{key:"initFileSelect",value:function(){var e=this,t=document.getElementById("loltony-file-select");t.setAttribute("type","file"),t.setAttribute("accepts","image/*"),t.setAttribute("multiple",!1),t.addEventListener("change",function(){e.addMainImageFromFile(t.files[0])}),this.fileSelectElem=t}},{key:"onSelectFile",value:function(){this.fileSelectElem.value=null,this.fileSelectElem.click()}},{key:"addMainImageFromFile",value:function(e){var t=this,n=new Image;n.addEventListener("load",function(){t.photoScale=t.imageView.setMainImage(n),t.hasImage=!0,t.enableSave(),t.$scope.$apply()}),n.src=this.$window.URL.createObjectURL(e)}},{key:"enableSave",value:function(){this.hasText&&this.hasImage?this.canSave="enabled":this.canSave="disabled"}},{key:"setTextFocus",value:function(){var e=document.getElementById(this.textId);e.style.visibility="visible",e.focus()}},{key:"onTextFocus",value:function(){this.imageView.onTextFocus()}},{key:"onTextChange",value:function(){this.hasText=!0,this.enableSave(),this.imageView.onTextChange(this.tonyText)}},{key:"onTextBlur",value:function(){document.getElementById(this.textId).style.visibility="hidden"}},{key:"onScaleChange",value:function(e){this.photoScale+=e,this.imageView.onScaleChange(this.photoScale)}},{key:"onSaveImage",value:function(){var e=this;if("enabled"===this.canSave){this.canSave="disabled";var t=this.imageView.getCanvasData();this.tonyDataService.uploadTony(t,function(t,n){console.log(t,n),"success"===t?e.showSuccessOverlay():e.showErrorOverlay()})}}},{key:"showErrorOverlay",value:function(){this.enableSave(),$("#tonymaker-overlay").modal("hide"),$("#tonymaker-error").modal("show").on("hide.bs.modal",function(){$("#tonymaker-overlay").modal("show")})}},{key:"showSuccessOverlay",value:function(){this.enableSave(),$("#tonymaker-overlay").modal("hide"),$("#tonymaker-success").modal("show")}}]),e}();t["default"]=s,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t){n(this,e),this.$interval=t}return i(e,[{key:"init",value:function(){this.images={},this.fullPhotoBounds={x:240,y:180,width:414,height:474,xRatio:0,yRatio:0},this.internalCanvas=document.createElement("canvas"),this.imageHolder=document.getElementById("loltony-holder"),this.children={},this.centerTextY=0,this.twoLineTextY=0,this.multiLineTextY=0,this.imageHolder.addEventListener("dragstart",function(e){e.preventDefault()}),this.initLoad()}},{key:"initLoad",value:function(){var e=this,t=new createjs.LoadQueue;t.on("complete",function(){e.onFilesLoaded(t)},this),t.loadManifest([{id:"trust",src:"/images/loltony-trust-2x.png"},{id:"write",src:"/images/loltony-write-2x.png"},{id:"overlay",src:"/images/loltony-overlay-2x.png"},{id:"placeholder",src:"/images/loltony-placeholder-2x.png"},{id:"base",src:"/images/loltony-base-2x.png"}])}},{key:"onFilesLoaded",value:function(e){this.images.trust=e.getResult("trust"),this.images.write=e.getResult("write"),this.images.overlay=e.getResult("overlay"),this.images.placeholder=e.getResult("placeholder"),this.images.base=e.getResult("base"),this.initInternalCanvas()}},{key:"initInternalCanvas",value:function(){var e=this.internalCanvas;e.width=this.images.overlay.width,e.height=this.images.overlay.height;var t=this.fullPhotoBounds;t.xRatio=t.x/e.width,t.yRatio=t.y/e.height,this.stage=new createjs.Stage(e),this.addChildren()}},{key:"addChildren",value:function(){var e=this.stage,t=this.children,n=new createjs.Bitmap(this.images.placeholder);e.addChild(n),t.placeholderImg=n;var i=new createjs.Bitmap(this.images.base);e.addChild(i),i.compositeOperation="multiply",t.baseImg=i;var a=new createjs.Bitmap(this.images.overlay);e.addChild(a),t.overlayImg=a;var o=new createjs.Bitmap(this.images.write);e.addChild(o),t.writeImg=o;var s=new createjs.Bitmap(this.images.trust);e.addChild(s),s.visible=!1,t.trustImg=s,this.addText(),this.update(),this.initComplete=!0}},{key:"update",value:function(){this.stage.update(),this.imageHolder.src=this.internalCanvas.toDataURL("image/jpeg")}},{key:"reset",value:function(){if(this.initComplete){var e=this.children;e.writeImg.visible=!0,e.placeholderImg.visible=!0,e.text.visible=!1,e.text.text="",e.mainImg&&this.stage.contains(e.mainImg)&&(this.stage.removeChild(e.mainImg),e.mainImg.image=null,e.mainImg=null,this.images.main=null),this.update()}}},{key:"addText",value:function(e){var t=new createjs.Text("...","38px GloriaHallelujah","#000000");t.textAlign="center",t.lineWidth=.63*this.internalCanvas.width,t.x=.68*this.internalCanvas.width,t.y=.5*(.3*this.internalCanvas.height-t.getBounds().height),t.rotation=-2,t.visible=!1,this.centerTextY=t.y,this.twoLineTextY=.5*(.3*this.internalCanvas.height-2*t.getBounds().height),this.multiLineTextY=.5*(.3*this.internalCanvas.height-3*t.getBounds().height),t.text="",this.stage.addChild(t),this.children.text=t}},{key:"onTextFocus",value:function(){this.children.text.visible=!0}},{key:"onTextChange",value:function(e){var t=this.children;t.text.text=e,t.text.visible=!0;var n=t.text.getMetrics().lines.length;n>2?t.text.y=this.multiLineTextY:2==n?t.text.y=this.twoLineTextY:t.text.y=this.centerTextY,t.writeImg.visible=!1,this.update()}},{key:"onScaleChange",value:function(e){var t=this.children.mainImg;t&&(t.scaleX=t.scaleY=.01*e,this.update())}},{key:"setMainImage",value:function(e){var t=this.stage,n=this.children.placeholderImg,i=this.fullPhotoBounds,a=new createjs.Bitmap(e);this.images.main=e,this.children.mainImg=a,a.x=i.x,a.y=i.y;var o=a.image.naturalWidth/i.width,s=a.image.naturalHeight/i.height,r=s>o?1/o:1/s;return a.scaleX=a.scaleY=r,t.addChildAt(a,0),n.visible=!1,this.update(),this.setDragHandler(),Math.ceil(100*r)}},{key:"modifyMainImagePosition",value:function(e,t){this.children.mainImg.x+=e,this.children.mainImg.y+=t}},{key:"setDragHandler",value:function(){var e=this,t=function(t){if(t.stopPropagation(),"touchstart"===t.type){var n={};n.pageX=t.changedTouches[0].pageX,n.pageY=t.changedTouches[0].pageY,e.touchEventCoords={x:n.pageX,y:n.pageY},e.onEventBegin(n,"touchmove","touchend")}else e.onEventBegin(t,"mousemove","mouseup")};this.imageHolder.addEventListener("touchstart",t,!1),this.imageHolder.addEventListener("mousedown",t,!1)}},{key:"onEventBegin",value:function(e,t,n){var i=this;this.isPointWithinBounds(e)&&!function(){var e="touchmove"===t?6:30;i.updateInterval=i.$interval(function(e){i.update()},1/e);var a=document.getElementsByTagName("body")[0],o=function(e){i.modifyMainImagePosition(e.movementX,e.movementY)},s=function(e){e.stopPropagation(),e.preventDefault();var t=i.touchEventCoords,n=e.changedTouches[0].pageX,a=e.changedTouches[0].pageY,s={};s.movementX=n-t.x,s.movementY=a-t.y,t.x=n,t.y=a,o(s)},r="touchmove"===t?s:o,l=function u(e){e.stopPropagation(),e.preventDefault(),i.$interval.cancel(i.updateInterval),a.removeEventListener(t,r,!1),a.removeEventListener(n,u,!1),i.touchEventCoords=null};a.addEventListener(t,r,!1),a.addEventListener(n,l,!1)}()}},{key:"isPointWithinBounds",value:function(e){var t=this.imageHolder,n=this.fullPhotoBounds,i=this.globalToLocal($(t),e.pageX,e.pageY),a=i.x/t.width,o=i.y/t.height;return a>=n.xRatio&&o>=n.yRatio}},{key:"globalToLocal",value:function(e,t,n){var i=e.offset();return{x:Math.floor(t-i.left),y:Math.floor(n-i.top)}}},{key:"getCanvasData",value:function(){this.children.trustImg.visible=!0,this.stage.update();var e=this.internalCanvas.toDataURL("image/jpeg");return this.children.trustImg.visible=!1,this.stage.update(),e}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t,i,a,o){n(this,e),this.$http=t,this.$q=i,this.$log=a,this.$document=o,this.init(),this.checkDeepLink(),this.loadData()}return i(e,[{key:"init",value:function(){var e={};e.title=this.$document[0].title;var t={},n=location.hostname+"/";t.base=-1!==n.indexOf("localhost")||-1!==n.indexOf("192.168.")?"http://52.30.249.142/":"/",t.origin=location.origin+"/",t.memeBase="tony/",t.imageList=t.base+"meme_api/memes/",t.imageUpload=t.base+"meme_api/memes/",e.urls=t;for(var i=[],a=0;42>a;++a)i.push({image:"/images/meme-2x.jpg",id:""+a});e.dummyList=i;var o=[];e.thumbList=o,e.currentTony={link:"",id:"",deeplink:""},this.data=e}},{key:"checkDeepLink",value:function(){var e=History.getState();if(-1===e.hash.indexOf(this.data.urls.memeBase));else{var t=parseInt(e.url.split(this.data.urls.memeBase)[1]);this.loadSingleTony(t)}}},{key:"loadSingleTony",value:function(e){var t=this,n=this.data;n.thumbList[e]?this.setCurrentTony(e):this.$http.get(""+n.urls.imageList+e).then(function(e){console.log(e),t.formatImageData(e.data),t.setCurrentTonyByData(e.data)},function(e,t){n.currentTony.link="images/meme-2x.jpg",n.currentTony.id="tony-1138",n.currentTony.deeplink=n.urls.memeBase+"0"})}},{key:"loadData",value:function(){var e=this;this.$http.get(this.data.urls.imageList).then(function(t){e.setThumbList(t.data)},function(t,n){e.setThumbList(e.data.dummyList),e.$log.warn("$http error - getThumbList: Using dummy list -",t,n)})}},{key:"getThumbList",value:function(){return this.data.thumbList}},{key:"setThumbList",value:function(e){var t=this.data.thumbList,n=this.data.urls.memeBase,i=""+this.data.urls.origin+n,a=this.formatImageData;t.splice(0,t.length);for(var o=e.length,s=0;o>s;++s){var r=e[s];a(r,i,n),t.push(r)}var l=History.getState();-1===l.hash.indexOf(n)&&(console.log("billy"),this.setCurrentTonyByData(t[t.length-1]))}},{key:"formatImageData",value:function(e,t,n){e.url=e.image,e.deeplink=""+t+e.id,e.pushState=""+n+e.id}},{key:"getCurrentTony",value:function(){return this.data.currentTony}},{key:"setCurrentTony",value:function(e){var t=this.data.currentTony,n=this.data.thumbList[e];this.setCurrentTonyByData(n);var i=-1===History.getState().hash.indexOf(this.data.urls.memeBase)?t.pushState:i=t.id;History.pushState({id:"tony-"+t.id},this.data.title+": "+t.id,i)}},{key:"setCurrentTonyByData",value:function(e){var t=this.data.currentTony;t.link=e.url,t.id=e.id,t.deeplink=e.deeplink,t.pushState=e.pushState}},{key:"uploadTony",value:function(e,t){this.$http.post(this.data.urls.imageUpload,{image:e}).then(function(e){t("success",e)},function(e,n){t("error",{message:e,code:n})})}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){return{restrict:"A",link:function(t,n,i){var a=function(n){n.preventDefault(),t.longPressInterval=e(function(){console.log("longpress"),t.$eval(i.onLongPress)},300)},o=function(n){n.preventDefault(),e.cancel(t.longPressInterval),i.onTouchEnd&&t.$eval(i.onTouchEnd)};n.bind("mousedown",a),n.bind("touchstart",a),n.bind("mouseup",o),n.bind("mouseleave",o),n.bind("touchend",o),n.bind("touchleave",o)}}},e.exports=t["default"]}]);